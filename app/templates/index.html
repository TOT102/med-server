<!---
<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PDF Report Manager</title>
</head>
<body>
    <h1>Upload PDF Report</h1>

    <form method="POST" action="{{ url_for('routes.upload_file') }}" enctype="multipart/form-data">
        <input type="file" name="file" accept="application/pdf" required>
        <input type="submit" value="Upload">
    </form>

    <br>

    <form action="{{ url_for('routes.download_latest') }}">
        <button type="submit">Download Latest Report</button>
    </form>

    <br>

    <form action="{{ url_for('routes.list_reports') }}">
        <button type="submit">View All Reports</button>
    </form>

    <br><br>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul style="color: red;">
          {% for message in messages %}
            <li>{{ message }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}
</body>
</html>
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Medical Data Server</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h2>Medical Indicator Viewer</h2>

    <label for="indicatorSelect">Select Indicator:</label>
    <select id="indicatorSelect">
        <option disabled selected>Loading...</option>
    </select>

    <canvas id="myChart" width="800" height="400"></canvas>

    <script>
        const ctx = document.getElementById('myChart').getContext('2d');
        let chart;

        function updateChart(indicator) {
            fetch(`/chart-data?indicator=${encodeURIComponent(indicator)}`)
                .then(res => res.json())
                .then(data => {
                    const labels = data.map(entry => entry.date);
                    const values = data.map(entry => entry.value);

                    if (chart) chart.destroy();
                    chart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: indicator,
                                data: values,
                                borderColor: 'rgba(75, 192, 192, 1)',
                                borderWidth: 2,
                                fill: false,
                                tension: 0.1
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                y: {
                                    beginAtZero: false
                                }
                            }
                        }
                    });
                });
        }

        // Populate dropdown with indicators
        fetch('/indicators')
            .then(res => res.json())
            .then(indicators => {
                const select = document.getElementById('indicatorSelect');
                select.innerHTML = ''; // Clear loading text

                indicators.forEach(indicator => {
                    const option = document.createElement('option');
                    option.value = indicator;
                    option.textContent = indicator;
                    select.appendChild(option);
                });

                select.addEventListener('change', () => {
                    updateChart(select.value);
                });
            });
    </script>
    <h1>Upload PDF Report</h1>

    <form method="POST" action="{{ url_for('routes.upload_file') }}" enctype="multipart/form-data">
        <input type="file" name="file" accept="application/pdf" required>
        <input type="submit" value="Upload">
    </form>

    <br>

    <form action="{{ url_for('routes.download_latest') }}">
        <button type="submit">Download Latest Report</button>
    </form>

    <br>

    <form action="{{ url_for('routes.list_reports') }}">
        <button type="submit">View All Reports</button>
    </form>

    <br><br>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul style="color: red;">
          {% for message in messages %}
            <li>{{ message }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}
</body>
</html>
